# üõ°Ô∏è TrustLayer - Security Governance Platform

Uma plataforma completa de governan√ßa de seguran√ßa multi-dom√≠nio para **AI Security**, **Cloud Security** e **DevSecOps**, baseada em frameworks reconhecidos internacionalmente como NIST AI RMF, ISO 27001/27002, LGPD, CSA CCM, OWASP e outros.

<div align="center">

<!-- Build & Quality -->
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen?logo=github&logoColor=white)](https://ai-assess-insight.lovable.app)
[![Tests](https://img.shields.io/badge/tests-passing-brightgreen?logo=vitest&logoColor=white)](https://ai-assess-insight.lovable.app)
[![Coverage](https://img.shields.io/badge/coverage-85%25-green?logo=codecov&logoColor=white)](https://ai-assess-insight.lovable.app)
[![Code Quality](https://img.shields.io/badge/code%20quality-A-brightgreen?logo=codacy&logoColor=white)](https://ai-assess-insight.lovable.app)

<!-- Version & Tech -->
[![Version](https://img.shields.io/badge/version-1.2.0-blue?logo=semanticrelease&logoColor=white)](https://ai-assess-insight.lovable.app)
[![React](https://img.shields.io/badge/React-18.3.1-61dafb?logo=react&logoColor=white)](https://react.dev/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.6-3178c6?logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Vite](https://img.shields.io/badge/Vite-5.4-646cff?logo=vite&logoColor=white)](https://vitejs.dev/)
[![Tailwind](https://img.shields.io/badge/Tailwind-3.4-38bdf8?logo=tailwindcss&logoColor=white)](https://tailwindcss.com/)

<!-- Backend & Infra -->
[![Supabase](https://img.shields.io/badge/Supabase-Self--Hosted-3ecf8e?logo=supabase&logoColor=white)](https://supabase.com/)
[![Edge Functions](https://img.shields.io/badge/Edge%20Functions-3-3ecf8e?logo=deno&logoColor=white)](https://supabase.com/docs/guides/functions)

<!-- License & Community -->
[![License](https://img.shields.io/badge/license-MIT-blue?logo=opensourceinitiative&logoColor=white)](LICENSE)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen?logo=github&logoColor=white)](https://ai-assess-insight.lovable.app)
[![i18n](https://img.shields.io/badge/i18n-3%20languages-blueviolet?logo=googletranslate&logoColor=white)](https://ai-assess-insight.lovable.app)

<!-- Frameworks Supported -->
[![NIST](https://img.shields.io/badge/NIST-AI%20RMF%20%7C%20SSDF-orange)](https://www.nist.gov/)
[![ISO](https://img.shields.io/badge/ISO-27001%20%7C%2027002%20%7C%2023894-blue)](https://www.iso.org/)
[![CSA](https://img.shields.io/badge/CSA-CCM%20v4-yellow)](https://cloudsecurityalliance.org/)
[![OWASP](https://img.shields.io/badge/OWASP-Top%2010-red)](https://owasp.org/)

</div>

## üì∏ Screenshots

<div align="center">

### üîê Login - Autentica√ß√£o Segura
![Login](docs/screenshots/login.png)
*Tela de login com credenciais pre-provisionadas*

---

### üìã Assessment - Question√°rio de Avalia√ß√£o
![Assessment](src/assets/screenshots/assessment.png)
*Question√°rio estruturado por dom√≠nios L1/L2 com campos de evid√™ncia*

---

### üìä Dashboard Executivo
![Executive Dashboard](src/assets/screenshots/dashboard-executive.png)
*Vis√£o estrat√©gica com KPIs, gr√°ficos de maturidade e roadmap para CISO*

---

### üìà Dashboard GRC
![GRC Dashboard](src/assets/screenshots/dashboard-grc.png)
*Governan√ßa, Riscos e Compliance com cobertura de frameworks e conformidade*

---

### üîß Dashboard Especialista
![Specialist Dashboard](src/assets/screenshots/dashboard-specialist.png)
*Detalhes t√©cnicos com m√©tricas por categoria e gaps cr√≠ticos*

---

### ü§ñ Assistente de IA
![AI Assistant](src/assets/screenshots/ai-assistant.png)
*Chat interativo com an√°lise contextual do assessment*

---

### ‚öôÔ∏è Configura√ß√µes - Gest√£o de Frameworks
![Settings Frameworks](src/assets/screenshots/frameworks.png)
*Gerenciamento de frameworks padr√£o e customizados*

</div>

---

## üìã Sobre o Projeto

Esta ferramenta permite que organiza√ß√µes avaliem sua postura de seguran√ßa em m√∫ltiplos dom√≠nios, identificando gaps cr√≠ticos, gerando roadmaps de remedia√ß√£o e acompanhando a evolu√ß√£o da maturidade ao longo do tempo.

### ‚ú® Principais Funcionalidades

#### üéØ Avalia√ß√£o Multi-Dom√≠nio
- **AI Security**: Avalia√ß√£o baseada em NIST AI RMF, ISO 23894
- **Cloud Security**: Avalia√ß√£o baseada em CSA CCM, ISO 27017
- **DevSecOps**: Avalia√ß√£o baseada em NIST SSDF, OWASP

#### üìä Dashboards Especializados
- **Executivo**: Vis√£o estrat√©gica para CISO e lideran√ßa com KPIs consolidados
- **GRC**: Governan√ßa, Riscos e Compliance com foco em cobertura de frameworks
- **Especialista**: Detalhes t√©cnicos para arquitetos e engenheiros de seguran√ßa
- **Layouts Modulares (Admin)**: Catalogo de widgets e layouts configuraveis por perfil

#### üìà An√°lise de Tend√™ncias
- **Hist√≥rico de Maturidade**: Snapshots autom√°ticos di√°rios para acompanhamento temporal
- **Compara√ß√£o de Per√≠odos**: Visualiza√ß√£o side-by-side de diferentes intervalos de tempo
- **Anota√ß√µes em Gr√°ficos**: Marca√ß√£o de eventos e milestones importantes
- **Indicadores por Dom√≠nio**: M√©tricas espec√≠ficas (NIST Functions, CSA Domains, SDLC Phases)

#### ü§ñ Assistente de IA
- **Chat Interativo**: An√°lise contextual do assessment com suporte a m√∫ltiplos provedores
- **Provedores de IA Configur√°veis**: OpenAI, Claude, Gemini, Ollama, Hugging Face
- **Padr√£o IA**: Utiliza **Lovable AI Gateway** por padr√£o (sem necessidade de API key)
  - Modelos suportados: GPT-5, GPT-5-mini, Gemini 2.5 Pro/Flash, entre outros
  - Fallback autom√°tico para provedores configurados pelo usu√°rio

#### üéôÔ∏è Sistema de Voz Inteligente

**Text-to-Speech (TTS):**
- **Padr√£o**: Web Speech API nativa do navegador (sem custo, funciona offline)
- Configura√ß√µes personaliz√°veis: idioma, velocidade, tom, volume e voz preferida
- Auto-speak opcional para respostas do assistente

**Speech-to-Text (STT):**
- **Padr√£o**: Web Speech API (reconhecimento em tempo real, gratuito)
- **Alternativas configur√°veis**:
  - OpenAI Whisper (alta precis√£o, requer API key)
  - Endpoint customizado (para modelos pr√≥prios)
- Suporte a transcri√ß√£o de arquivos de √°udio
- Se o provedor exigir API key e ela nao estiver configurada (ou inline secrets desabilitados), o STT fica desativado.

**Perfil de Voz (Speaker Verification):**
- **Cadastro biom√©trico**: Grave frases para treinar o sistema a reconhecer sua voz
- **N√≠veis de enrollment**: Padr√£o (6 frases, ~2min) ou Avan√ßado (12 frases, ~5min)
- **Verifica√ß√£o autom√°tica**: Filtra comandos de vozes n√£o cadastradas
- **Processamento em Web Worker**: Extra√ß√£o de features em background sem bloquear UI
- **Visualiza√ß√£o em tempo real**: Barras de √°udio que respondem ao volume do microfone
- **Barra de progresso**: Indicador visual durante processamento de √°udio
- **Indicador visual**: Mostra status de verifica√ß√£o em tempo real no chat
- **Sensibilidade ajust√°vel**: Slider para calibrar rigor da verifica√ß√£o

**Features de √Åudio Extra√≠das:**
- MFCC (13 coeficientes) - Timbre vocal
- Pitch Mean/Std - Tom de voz
- RMS Energy - Intensidade
- Zero Crossing Rate - Caracter√≠sticas espectrais
- Speaking Rate - Ritmo da fala

**Comandos de Voz:**
- Navega√ß√£o entre p√°ginas por comando de voz
- Consulta de dados e m√©tricas
- Troca de dom√≠nios de seguran√ßa
- Exporta√ß√£o de relat√≥rios

#### üîó Integra√ß√µes
- **SIEM Integration**: Encaminhamento de eventos em JSON, CEF, LEEF, Syslog
- **Monitoramento de Sa√∫de**: M√©tricas de lat√™ncia, taxa de sucesso e status de conex√£o
- **Audit Logging**: Logs detalhados com IP, user-agent e geolocaliza√ß√£o

#### üìã Gest√£o de Conte√∫do
- **Frameworks Customiz√°veis**: Adicionar, editar ou desabilitar frameworks
- **Quest√µes Personalizadas**: Criar quest√µes espec√≠ficas da organiza√ß√£o
- **Versionamento**: Hist√≥rico de altera√ß√µes com diff e rollback
- **Import/Export**: Importa√ß√£o em massa via Excel e exporta√ß√£o de configura√ß√µes

#### üåê Internacionaliza√ß√£o
- Suporte completo a **Portugu√™s (BR)**, **English (US)** e **Espa√±ol (ES)**
- Sincroniza√ß√£o de prefer√™ncia de idioma no perfil do usu√°rio

#### üìÑ Exporta√ß√£o de Relat√≥rios
- **HTML Standalone**: Relat√≥rios fi√©is ao estado atual do dashboard
- **Gr√°ficos SVG**: Visualiza√ß√µes vetoriais de alta qualidade
- **Roadmap Estrat√©gico**: Prioriza√ß√£o em horizontes de 30/60/90 dias

## üõ†Ô∏è Stack Tecnol√≥gica

| Tecnologia | Uso |
|------------|-----|
| [React 18](https://react.dev/) | Framework UI |
| [TypeScript](https://www.typescriptlang.org/) | Tipagem est√°tica |
| [Vite](https://vitejs.dev/) | Build tool e dev server |
| [Tailwind CSS](https://tailwindcss.com/) | Estiliza√ß√£o |
| [shadcn/ui](https://ui.shadcn.com/) | Componentes UI |
| [Zustand](https://zustand-demo.pmnd.rs/) | Gerenciamento de estado |
| [Recharts](https://recharts.org/) | Visualiza√ß√£o de dados |
| [Supabase](https://supabase.com/) | Backend (banco de dados, auth, edge functions) |
| [TanStack Query](https://tanstack.com/query) | Gerenciamento de dados ass√≠ncronos |
| [React Router](https://reactrouter.com/) | Roteamento |
| [i18next](https://www.i18next.com/) | Internacionaliza√ß√£o |
| [ExcelJS](https://github.com/exceljs/exceljs) | Importa√ß√£o/Exporta√ß√£o Excel |
| [Web Speech API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API) | TTS/STT nativo do navegador |
| [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) | An√°lise de √°udio em tempo real |
| [Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API) | Processamento em background |
| [Framer Motion](https://www.framer.com/motion/) | Anima√ß√µes |

## üîä Configura√ß√£o Padr√£o de IA e Voz

### Intelig√™ncia Artificial

| Configura√ß√£o | Padr√£o | Alternativas |
|--------------|--------|--------------|
| **Gateway** | Lovable AI Gateway | Provedores customizados |
| **Modelo LLM** | GPT-5 / Gemini 2.5 Pro | GPT-5-mini, Gemini Flash, Claude, Ollama |
| **API Key** | N√£o necess√°ria (gateway) | Obrigat√≥ria para provedores externos |
| **Contexto** | Assessment atual + hist√≥rico | Personaliz√°vel por provedor |

### S√≠ntese de Voz (TTS)

| Configura√ß√£o | Padr√£o | Faixa |
|--------------|--------|-------|
| **Provedor** | Web Speech API | Nativo do navegador |
| **Idioma** | pt-BR | pt-BR, en-US, es-ES |
| **Velocidade** | 1.0x | 0.5x - 2.0x |
| **Tom (Pitch)** | 1.0 | 0.5 - 2.0 |
| **Volume** | 1.0 | 0.0 - 1.0 |
| **Auto-Speak** | Desativado | Ativ√°vel por toggle |

### Reconhecimento de Voz (STT)

| Configura√ß√£o | Padr√£o | Alternativas |
|--------------|--------|--------------|
| **Provedor** | Web Speech API | OpenAI Whisper, Custom Endpoint |
| **Modo** | Tempo real | Transcri√ß√£o de arquivo (Whisper) |
| **Idioma** | pt-BR | Configur√°vel no perfil |
| **API Key** | N√£o necess√°ria | Obrigat√≥ria para Whisper |

### Perfil de Voz (Verifica√ß√£o de Locutor)

| Configura√ß√£o | Padr√£o | Descri√ß√£o |
|--------------|--------|-----------|
| **Status** | Desativado | Ativado ap√≥s enrollment |
| **N√≠vel** | Padr√£o (6 frases) | Avan√ßado (12 frases) dispon√≠vel |
| **Sensibilidade** | 65% | Ajust√°vel de 40% a 90% |
| **Processamento** | Web Worker | Background thread, n√£o bloqueia UI |
| **Visualiza√ß√£o** | Tempo real | 12 barras de frequ√™ncia animadas |
| **Features** | MFCC, Pitch, Spectral, Energy | An√°lise multi-dimensional |

## üì¶ Pr√©-requisitos

- **Node.js** 18.x ou superior
- **npm** 9.x ou superior (ou yarn/pnpm)

## üöÄ Instala√ß√£o e Execu√ß√£o Local

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/trustlayer/trustlayer.git
cd trustlayer
```

### 2. Instale as depend√™ncias

```bash
npm install
```

### 3. Bootstrap do admin e cat√°logo

Veja `docs/SETUP.md` para:
- criar o usu√°rio administrador
  - provisionar usuarios locais (sem signup)
- importar o cat√°logo inicial (dom√≠nios, frameworks, perguntas)
  - painel administrativo em /admin (nao aparece na sidebar)
  - revisar o preview/dry-run do XLSX antes de importar

### 4. Execute o servidor de desenvolvimento

```bash
npm run dev
```

A aplica√ß√£o estar√° dispon√≠vel em `http://localhost:5173`

> **Nota**: O backend utiliza Supabase self-hosted ou Postgres externo, conforme o modo de implantacao.

## üìú Scripts Dispon√≠veis

| Comando | Descri√ß√£o |
|---------|-----------|
| `npm run dev` | Inicia o servidor de desenvolvimento |
| `npm run build` | Gera build de produ√ß√£o |
| `npm run preview` | Visualiza o build de produ√ß√£o localmente |
| `npm run lint` | Executa o linter (ESLint) |
| `npm run test` | Executa os testes |
| `npm run provision:admin` | Provisiona o usuario administrador inicial |
| `npm run provision:user` | Provisiona usuarios locais (sem signup) |
| `USER_ROLE=admin|manager|analyst|viewer|user` | Define role ao provisionar usuarios (user = legado) |

## üìÅ Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ components/           # Componentes React reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # Componentes shadcn/ui
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/       # Componentes de dashboard
‚îÇ   ‚îú‚îÄ‚îÄ settings/        # Componentes de configura√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ ai-assistant/    # Componentes do assistente IA
‚îÇ   ‚îî‚îÄ‚îÄ auth/            # Componentes de autentica√ß√£o
‚îú‚îÄ‚îÄ data/                # (legacy) cat√°logo migrado para o banco de dados
‚îú‚îÄ‚îÄ hooks/               # Custom React hooks
‚îú‚îÄ‚îÄ i18n/                # Arquivos de internacionaliza√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ locales/         # Tradu√ß√µes (pt-BR, en-US, es-ES)
‚îú‚îÄ‚îÄ integrations/        # Integra√ß√µes externas (Supabase)
‚îú‚îÄ‚îÄ lib/                 # Utilit√°rios e l√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ database.ts      # Opera√ß√µes de banco de dados
‚îÇ   ‚îú‚îÄ‚îÄ scoring.ts       # C√°lculos de maturidade e m√©tricas
‚îÇ   ‚îú‚îÄ‚îÄ frameworks.ts    # Gerenciamento de frameworks
‚îÇ   ‚îú‚îÄ‚îÄ securityDomains.ts # Gerenciamento de dom√≠nios
‚îÇ   ‚îú‚îÄ‚îÄ siemIntegration.ts # Integra√ß√£o SIEM
‚îÇ   ‚îú‚îÄ‚îÄ auditLog.ts      # Sistema de auditoria
‚îÇ   ‚îî‚îÄ‚îÄ stores.ts        # Stores Zustand
‚îú‚îÄ‚îÄ pages/               # P√°ginas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Home.tsx         # P√°gina inicial com onboarding
‚îÇ   ‚îú‚îÄ‚îÄ Assessment.tsx   # Question√°rio de avalia√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard*.tsx   # Dashboards (Executive, GRC, Specialist)
‚îÇ   ‚îú‚îÄ‚îÄ Profile.tsx      # Perfil do usu√°rio
‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx     # Configura√ß√µes
‚îî‚îÄ‚îÄ test/                # Testes

supabase/
‚îú‚îÄ‚îÄ functions/           # Edge Functions
‚îÇ   ‚îú‚îÄ‚îÄ ai-assistant/    # Assistente de IA
‚îÇ   ‚îú‚îÄ‚îÄ audit-log/       # Registro de auditoria
‚îÇ   ‚îú‚îÄ‚îÄ siem-forward/    # Encaminhamento SIEM
‚îî‚îÄ‚îÄ config.toml          # Configura√ß√£o Supabase
```

## üóÑÔ∏è Banco de Dados

### Principais Tabelas

| Tabela | Descri√ß√£o |
|--------|-----------|
| `security_domains` | Dom√≠nios de seguran√ßa (AI, Cloud, DevSecOps) |
| `domains` | Categorias L1 da taxonomia |
| `subcategories` | Subcategorias L2 da taxonomia |
| `default_questions` | Quest√µes padr√£o do sistema |
| `custom_questions` | Quest√µes personalizadas do usu√°rio |
| `answers` | Respostas do assessment |
| `default_frameworks` | Frameworks padr√£o |
| `custom_frameworks` | Frameworks personalizados |
| `assessment_meta` | Metadados (frameworks habilitados/selecionados) |
| `maturity_snapshots` | Hist√≥rico de maturidade |
| `chart_annotations` | Anota√ß√µes em gr√°ficos |
| `ai_providers` | Configura√ß√µes de provedores IA |
| `siem_integrations` | Integra√ß√µes SIEM |
| `siem_metrics` | M√©tricas de sa√∫de SIEM |
| `change_logs` | Logs de auditoria |
| `question_versions` | Versionamento de quest√µes |
| `profiles` | Perfis de usu√°rio |
| `voice_profiles` | Perfis de voz para verifica√ß√£o de locutor |
| `voice_enrollment_samples` | Amostras de √°udio do enrollment |

## üéØ Fluxo de Uso

1. **Login**: Acesse com suas credenciais fornecidas pelo administrador
2. **Selecione o Dom√≠nio**: Escolha entre AI Security, Cloud Security ou DevSecOps
3. **Configure Frameworks**: Habilite os frameworks relevantes para sua organiza√ß√£o
4. **Avalia√ß√£o**: Responda √†s quest√µes (Sim/Parcial/N√£o/NA) com evid√™ncias
5. **Dashboards**: Analise m√©tricas, gaps e roadmap por perfil (Executivo/GRC/Especialista)
6. **Compare Per√≠odos**: Visualize evolu√ß√£o comparando diferentes intervalos de tempo
7. **Exporte**: Gere relat√≥rios HTML para compartilhamento

## üîí Seguran√ßa

- **Row Level Security (RLS)**: Habilitado em todas as tabelas
- **Autentica√ß√£o**: Contas provisionadas pelo administrador; SSO opcional (OIDC/SAML)
- **Rate Limiting**: Prote√ß√£o contra brute-force no login
- **API Payload Validation**: Allowlist de entity/action e limites de tamanho em audit/siem.
- **Role Escalation Guard**: Role de perfil so pode ser alterada via service role.
- **RBAC Baseline**: Roles admin/manager/analyst/viewer (viewer = leitura).
- **RLS Answers**: Escrita de respostas permitida apenas para admin/manager/analyst/user.
- **RLS Config**: Escrita de configuracoes e anotacoes bloqueada para viewer.
- **Catalog Write Policies**: Escrita em tabelas globais restrita a administradores.
- **Admin-Only Integrations**: Escrita em AI providers e SIEM restrita a administradores.
- **Valida√ß√£o de Senha**: Requisitos de complexidade (8+ chars, mai√∫sculas, n√∫meros, s√≠mbolos)
- **Auditoria**: Logs detalhados de todas as a√ß√µes
- **Isolamento Multi-Tenant**: Dados segregados por usu√°rio e dom√≠nio

## üß™ Testes

```bash
# Executar todos os testes
npm run test

# Testes incluem:
# - Valida√ß√£o de chaves i18n
# - Consist√™ncia de placeholders
# - Snapshots de tradu√ß√µes
```

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/nova-feature`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/nova-feature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üìû Suporte

- Abra uma issue para reportar bugs
- Discuss√µes e sugest√µes s√£o bem-vindas

## üìö Documenta√ß√£o Adicional

- [API Reference](docs/API.md) - Documenta√ß√£o das Edge Functions
- [Architecture](docs/ARCHITECTURE.md) - Diagramas de arquitetura do sistema
- [Contributing](docs/CONTRIBUTING.md) - Guia de contribui√ß√£o
- [Admin Console](docs/ADMIN_CONSOLE.md) - Painel administrativo
- [Backup and DR Runbook](docs/runbooks/BACKUP_DR.md) - Procedimentos de backup e recuperacao.
- [Data Retention](docs/DATA_RETENTION.md) - Politicas de retencao e limpeza de dados.
- [Analytics Export](docs/ANALYTICS_EXPORT.md) - Pipeline de exportacao para analytics.
- [Secret Provider](docs/SECRET_PROVIDER.md) - Resolver externo de segredos.
- [Changelog](docs/CHANGELOG.md) - Hist√≥rico de mudan√ßas
- [LLM Reference](llm.txt) - Refer√™ncia para assistentes de IA

## Documentation Policy

- Every feature, fix, or change must update the relevant docs, including README, llm.txt, and CHANGELOG.

## Security Baseline

See `docs/SECURITY_BASELINE.md` for the OWASP Top 10 control mapping and enterprise baseline.
Edge Functions include `X-Request-Id` for log correlation.
Viewer role uses read-only gating for domain/framework selection (UI and voice commands).
Read-only roles skip maturity snapshot writes.
Role lookups are cached client-side (60s TTL) to reduce repeated profile queries.
Domain/framework selection rolls back locally if persistence fails.
Read-only assessment defaults to enabled frameworks when no selection is stored.

## Observability

Baseline and runbooks live in:
- `docs/OBSERVABILITY.md`
- `docs/runbooks/INCIDENT_RESPONSE.md`
- `docs/runbooks/ALERTS.md`

---

Desenvolvido com ‚ù§Ô∏è para a comunidade de seguran√ßa



## Docker (Frontend)

Build and run the frontend image:

```bash
docker build \
  --build-arg VITE_SUPABASE_URL=http://127.0.0.1:54321 \
  --build-arg VITE_SUPABASE_PUBLISHABLE_KEY=your-publishable-key \
  -t trustlayer-web .

docker run --rm -p 8080:8080 trustlayer-web
```

Health check endpoint: `http://localhost:8080/healthz`.

Optional env flags:
- `VITE_ALLOW_LOCAL_ENDPOINTS=true` (frontend) and `ALLOW_LOCAL_ENDPOINTS=true` (Edge Functions) to allow local/private endpoints for admin-configured integrations.
- `VITE_IMPORT_MAX_FILE_BYTES=5242880` to cap XLSX/JSON import file size.
- `VITE_IMPORT_MAX_CELL_CHARS=2000` to cap cell length in XLSX imports.
- `VITE_IMPORT_MAX_ROWS=5000` to cap XLSX import row count.
- `VITE_IMPORT_MALWARE_SCAN_URL=https://scanner.local/scan` to enable optional XLSX antivirus scanning (expects multipart file upload and JSON response).
- `VITE_IMPORT_MALWARE_SCAN_REQUIRED=true` to block imports when the scanner is unavailable or not configured.
- `VITE_ALLOW_INLINE_SECRETS=true` to allow storing raw secrets in the database (not recommended; required for API-key STT providers).
- `SECRET_PROVIDER_URL=https://secrets.local/resolve` to enable external secret resolver for `secret:` references (Edge Functions).
- `SECRET_PROVIDER_TOKEN=env:SECRET_PROVIDER_TOKEN` optional auth token for the external secret resolver (supports `env:` or `file:`).
- `SECRET_PROVIDER_TIMEOUT_MS=10000` to set the external secret resolver timeout (ms).
- See `docs/SECRET_PROVIDER.md` for the external resolver contract.
- `VITE_ANALYTICS_EXPORT_ENABLED=true` to enable analytics export hooks from the frontend.
- `ANALYTICS_EXPORT_URL=https://analytics.local/ingest` to enable the analytics export Edge Function.
- `ANALYTICS_EXPORT_TOKEN=env:ANALYTICS_EXPORT_TOKEN` optional auth token for analytics export (supports `env:` or `file:`).
- `ANALYTICS_EXPORT_TIMEOUT_MS=10000` to set the analytics export timeout (ms).
- `ANALYTICS_EXPORT_INCLUDE_USER_ID=false` to control whether user IDs are included in analytics payloads.
- See `docs/ANALYTICS_EXPORT.md` for the analytics export contract.
- `VITE_IDLE_TIMEOUT_MINUTES=0` to disable/enable idle logout (set to minutes > 0).
- `VITE_SESSION_MAX_MINUTES=0` to disable/enable absolute session timeout (minutes > 0).
- STT API keys are only fetched from profiles when `VITE_ALLOW_INLINE_SECRETS=true`.
- `ALLOWED_ORIGINS=https://app.example.com` to restrict Edge Function CORS origins.
- `MAX_REQUEST_BODY_BYTES=1048576` to cap Edge Function payload size.
- `AUDIT_GEO_LOOKUP_ENABLED=true` to enable external geo lookup enrichment.
- `MAX_AI_MESSAGES=50` to cap AI message payload size.
- `MAX_AI_MESSAGE_CHARS=4000` to cap characters per AI message.
- `MAX_AI_TOTAL_CHARS=20000` to cap total characters across AI messages.
- `RATE_LIMIT_WINDOW_SECONDS=60` to define the Edge Function rate limit window.
- `AI_ASSISTANT_RATE_LIMIT_MAX=60` to cap AI assistant requests per window.
- `AUDIT_LOG_RATE_LIMIT_MAX=120` to cap audit log requests per window.
- `SIEM_FORWARD_RATE_LIMIT_MAX=60` to cap SIEM forward requests per window.
- `ANALYTICS_EXPORT_RATE_LIMIT_MAX=60` to cap analytics export requests per window.
- `HTTP_PROXY=http://proxy.local:8080` to proxy outbound Edge Function traffic.
- `HTTPS_PROXY=http://proxy.local:8443` to proxy outbound HTTPS traffic.
- `NO_PROXY=localhost,127.0.0.1,::1,.internal` to bypass the proxy for specific hosts.
- `CUSTOM_CA_CERT=...` to trust a custom CA bundle (PEM) for TLS inspection.
- `CUSTOM_CA_CERT_BASE64=...` to trust a custom CA bundle (base64) for TLS inspection.



