# TrustLayer - Security Governance Platform

> LLM-friendly overview of the TrustLayer codebase for AI assistants and developers.

## Project Summary

TrustLayer is a multi-domain security governance platform built with React, TypeScript, and Supabase. It enables organizations to assess their security posture across **AI Security**, **Cloud Security**, and **DevSecOps** domains using internationally recognized frameworks like NIST AI RMF, ISO 27001/27002, CSA CCM, and OWASP.

## Tech Stack

- **Frontend**: React 18, TypeScript, Vite, Tailwind CSS, shadcn/ui
- **State Management**: Zustand, TanStack Query
- **Backend**: Supabase self-hosted (PostgreSQL, Auth, Edge Functions) or external Postgres
- **Charts**: Recharts
- **i18n**: react-i18next (PT-BR, EN-US, ES-ES)
- **Animations**: Framer Motion
- **Voice**: Web Speech API, Web Audio API, Web Workers

## Project Structure

```
src/
├── components/           # React components
│   ├── ui/              # shadcn/ui base components
│   ├── dashboard/       # Dashboard-specific components
│   ├── settings/        # Settings/configuration components
│   ├── ai-assistant/    # AI chat and voice components
│   └── auth/            # Authentication components
├── pages/               # Route pages
│   ├── Home.tsx         # Landing/onboarding page
│   ├── Assessment.tsx   # Security questionnaire
│   ├── Dashboard.tsx    # Main dashboard router
│   ├── DashboardExecutive.tsx   # C-level view
│   ├── DashboardGRC.tsx         # Governance/Risk/Compliance view
│   ├── DashboardSpecialist.tsx  # Technical specialist view
│   ├── Settings.tsx     # Configuration panels
│   └── Profile.tsx      # User profile
├── hooks/               # Custom React hooks
│   ├── useDashboardMetrics.ts   # Core metrics calculation
│   ├── useAIAssistant.ts        # AI chat integration
│   ├── useVoiceProfile.ts       # Voice biometrics
│   ├── useSpeechRecognition.ts  # Speech-to-text
│   └── useSpeechSynthesis.ts    # Text-to-speech
├── lib/                 # Business logic
│   ├── database.ts      # Supabase operations
│   ├── scoring.ts       # Maturity calculations
│   ├── frameworks.ts    # Framework management
│   ├── securityDomains.ts       # Domain management
│   ├── siemIntegration.ts       # SIEM forwarding
│   └── auditLog.ts      # Audit logging
├── data/                # Static JSON (questions, taxonomy, frameworks)
├── i18n/                # Internationalization
│   └── locales/         # Translation files
└── integrations/        # External integrations
    └── supabase/        # Supabase client and types

supabase/
└── functions/           # Edge Functions (Deno)
    ├── ai-assistant/    # AI chat with multiple providers
    ├── audit-log/       # Audit logging with geolocation
    ├── siem-forward/    # SIEM event forwarding
    ├── init-demo-user/  # (removed in enterprise builds)
    └── init-demo-data/  # (removed in enterprise builds)

docs/
├── API.md               # Edge Functions API documentation
├── ARCHITECTURE.md      # System architecture diagrams
├── LINKEDIN_POST.md     # Marketing content
└── screenshots/         # Application screenshots
```

## Key Features

### 1. Multi-Domain Assessment
- **AI Security**: NIST AI RMF, ISO 42001, EU AI Act compliance
- **Cloud Security**: CSA CCM v4, CIS Controls, SOC 2
- **DevSecOps**: NIST SSDF, OWASP SAMM, SLSA

### 2. Specialized Dashboards
- **Executive**: C-level KPIs, maturity scores, strategic roadmap
- **GRC**: Framework coverage, compliance metrics, audit readiness
- **Specialist**: Technical gaps, category-level analysis, evidence tracking

### 3. AI Assistant
- Multi-provider support (Lovable AI, OpenAI, Claude, Gemini, Ollama)
- Contextual analysis based on current assessment
- Streaming responses with SSE
- Voice input/output with biometric verification

### 4. Voice System
- **STT**: Web Speech API, OpenAI Whisper, custom endpoints
- **TTS**: Native browser voices with queue management
- **Voice Profile**: Biometric enrollment with MFCC feature extraction
- **Commands**: Navigation, domain switching, data queries, exports

### 5. Integrations
- **SIEM**: JSON, CEF, LEEF, Syslog formats
- **Audit Logging**: IP, geolocation, device info
- **Export**: HTML reports, Excel spreadsheets

## Database Schema (Key Tables)

| Table | Purpose |
|-------|---------|
| `security_domains` | AI Security, Cloud Security, DevSecOps |
| `domains` | L1 taxonomy categories |
| `subcategories` | L2 taxonomy subcategories |
| `default_questions` | System questions (143 AI, 36 Cloud, 44 DevSecOps) |
| `custom_questions` | User-created questions |
| `answers` | Assessment responses with evidence |
| `maturity_snapshots` | Historical maturity data |
| `ai_providers` | AI provider configurations |
| `siem_integrations` | SIEM endpoint configurations |
| `change_logs` | Audit trail |
| `voice_profiles` | Voice biometric data |
| `profiles` | User settings and preferences |

## Security

- **RLS**: Row Level Security on all user data tables
- **Authentication**: Admin-provisioned accounts; SSO optional (OIDC/SAML)
- **Rate Limiting**: Client-side exponential backoff on login
- **Password Policy**: 8+ chars, mixed case, numbers, symbols
- **Multi-tenant Isolation**: User and domain-scoped data

## API Endpoints

| Endpoint | Auth | Purpose |
|----------|------|---------|
| `POST /ai-assistant` | JWT | AI chat with streaming |
| `POST /audit-log` | JWT | Record audit events |
| `POST /siem-forward` | JWT | Forward to SIEM systems |

## Development

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Run tests
npm run test

# Build for production
npm run build
```

## Key Patterns

### Scoring System
- Responses: Sim (1.0), Parcial (0.5), Não (0.0), NA (excluded)
- Maturity Levels: 1-Inicial (0-34%), 2-Básico (35-49%), 3-Intermediário (50-64%), 4-Avançado (65-79%), 5-Otimizado (80-100%)

### State Management
- **Zustand**: Security domain and framework selection
- **React Query**: Async data (answers, snapshots, providers)
- **Local State**: UI state, form state

### Component Conventions
- Dashboard components use `DashboardSection`, `DashboardKPICard`, `DashboardChartCard`
- Settings panels use `AnimatedCard`, `FilterBar`, `StatsGrid`
- All components support dark mode via semantic tokens

## Documentation

- `/docs/API.md` - Complete Edge Functions API reference
- `/docs/ARCHITECTURE.md` - System architecture with Mermaid diagrams
- `/docs/LINKEDIN_POST.md` - Marketing and announcement content
- `/docs/screenshots/README.md` - Screenshot capture guidelines
- Documentation policy: every feature, fix, or change must update README, llm.txt, relevant docs, and CHANGELOG.

## Contact

- **Repository**: GitHub (open source)
