-- Seed Cloud Security domains
INSERT INTO public.domains (domain_id, domain_name, description, display_order, nist_ai_rmf_function, strategic_question, banking_relevance, security_domain_id)
VALUES
  ('CLOUD-GOVERN', 'Cloud Governance & Strategy', 'Políticas, estratégia de cloud, papéis e responsabilidades compartilhadas', 1, 'GOVERN', 'A organização possui governança adequada para ambientes cloud?', 'Crítico para conformidade com requisitos do BACEN sobre cloud computing', 'CLOUD_SECURITY'),
  ('CLOUD-IAM', 'Identity & Access Management', 'Identidades, autenticação, autorização e gestão de privilégios em cloud', 2, 'MANAGE', 'A gestão de identidades e acessos em cloud é adequada?', 'Essencial para controle de acesso conforme Res. CMN 4.893', 'CLOUD_SECURITY'),
  ('CLOUD-DATA', 'Cloud Data Protection', 'Criptografia, classificação, DLP e proteção de dados em ambientes cloud', 3, 'MANAGE', 'Os dados em cloud estão adequadamente protegidos?', 'Crítico para sigilo bancário e conformidade LGPD', 'CLOUD_SECURITY'),
  ('CLOUD-INFRA', 'Cloud Infrastructure Security', 'Segurança de redes, containers, serverless e configuração de infraestrutura', 4, 'MANAGE', 'A infraestrutura cloud está configurada de forma segura?', 'Suporta requisitos de segurança de infraestrutura do BACEN', 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE', 'Cloud Security Posture', 'CSPM, compliance contínuo, detecção de misconfigurações e drift', 5, 'MEASURE', 'A postura de segurança cloud é monitorada e gerida?', 'Alinhado com monitoramento contínuo exigido pelo BACEN', 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD', 'Workload Protection', 'CWPP, proteção de containers, VMs, funções serverless e microsserviços', 6, 'MANAGE', 'As cargas de trabalho em cloud estão protegidas?', 'Proteção de workloads críticos conforme requisitos de segurança cibernética', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT', 'Cloud Detection & Response', 'Logging, monitoramento, SIEM cloud, detecção de ameaças e resposta', 7, 'MEASURE', 'Ameaças em cloud são detectadas e respondidas adequadamente?', 'Suporta capacidades de detecção exigidas pela Res. CMN 4.893', 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE', 'Cloud Resilience & Continuity', 'Backup, DR, alta disponibilidade e continuidade de negócios em cloud', 8, 'MANAGE', 'A resiliência e continuidade em cloud estão garantidas?', 'Alinhado com requisitos de continuidade de negócios do BACEN', 'CLOUD_SECURITY')
ON CONFLICT (domain_id) DO UPDATE SET
  domain_name = EXCLUDED.domain_name,
  description = EXCLUDED.description,
  display_order = EXCLUDED.display_order,
  nist_ai_rmf_function = EXCLUDED.nist_ai_rmf_function,
  strategic_question = EXCLUDED.strategic_question,
  banking_relevance = EXCLUDED.banking_relevance,
  security_domain_id = EXCLUDED.security_domain_id;

-- Seed DevSecOps domains
INSERT INTO public.domains (domain_id, domain_name, description, display_order, nist_ai_rmf_function, strategic_question, banking_relevance, security_domain_id)
VALUES
  ('DEVSEC-GOVERN', 'DevSecOps Governance', 'Políticas, cultura, métricas e estratégia de integração de segurança no SDLC', 1, 'GOVERN', 'A organização possui governança adequada para DevSecOps?', 'Crítico para conformidade com requisitos de desenvolvimento seguro do BACEN', 'DEVSECOPS'),
  ('DEVSEC-CODE', 'Secure Coding & SAST', 'Padrões de código seguro, análise estática, revisão de código e treinamento', 2, 'MANAGE', 'O código é desenvolvido seguindo práticas de segurança?', 'Essencial para prevenção de vulnerabilidades em aplicações bancárias', 'DEVSECOPS'),
  ('DEVSEC-DEPS', 'Dependency & SCA', 'SCA, gestão de dependências, SBOM e supply chain security', 3, 'MAP', 'As dependências e componentes são geridos de forma segura?', 'Crítico para mitigar riscos de supply chain como SolarWinds', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE', 'CI/CD Pipeline Security', 'Segurança de pipeline, secrets management, integridade de build e deploy', 4, 'MANAGE', 'O pipeline de CI/CD é seguro e protegido?', 'Pipeline comprometido pode inserir backdoors em aplicações críticas', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER', 'Container & Image Security', 'Scan de imagens, hardening de containers, registry security e runtime', 5, 'MANAGE', 'As imagens e containers são seguros?', 'Containers são base de aplicações modernas e requerem controles específicos', 'DEVSECOPS'),
  ('DEVSEC-IAC', 'Infrastructure as Code Security', 'Scan de IaC, templates seguros, policy as code e drift detection', 6, 'MANAGE', 'A infraestrutura como código é segura?', 'IaC inseguro propaga misconfigurações em escala', 'DEVSECOPS'),
  ('DEVSEC-TEST', 'Security Testing', 'DAST, IAST, fuzzing, pen testing e testes de API', 7, 'MEASURE', 'Os testes de segurança são adequados e integrados?', 'Testes identificam vulnerabilidades antes de produção', 'DEVSECOPS'),
  ('DEVSEC-VULN', 'Vulnerability Management', 'Priorização, remediação, tracking e métricas de vulnerabilidades', 8, 'MANAGE', 'As vulnerabilidades são geridas de forma eficaz?', 'Gestão eficaz reduz janela de exposição a exploração', 'DEVSECOPS')
ON CONFLICT (domain_id) DO UPDATE SET
  domain_name = EXCLUDED.domain_name,
  description = EXCLUDED.description,
  display_order = EXCLUDED.display_order,
  nist_ai_rmf_function = EXCLUDED.nist_ai_rmf_function,
  strategic_question = EXCLUDED.strategic_question,
  banking_relevance = EXCLUDED.banking_relevance,
  security_domain_id = EXCLUDED.security_domain_id;

-- Seed Cloud Security subcategories
INSERT INTO public.subcategories (subcat_id, domain_id, subcat_name, definition, objective, security_outcome, criticality, weight, ownership_type, risk_summary, framework_refs, security_domain_id)
VALUES
  ('CLOUD-GOVERN-01', 'CLOUD-GOVERN', 'Cloud Strategy & Policies', 'Estratégia de adoção de cloud e políticas de uso', 'Estabelecer diretrizes claras para adoção e uso de cloud', 'Uso de cloud alinhado com objetivos de negócio e segurança', 'High', 1.3, 'GRC', 'Sem estratégia, adoção de cloud é fragmentada e insegura', ARRAY['CSA CCM GRC', 'ISO 27017', 'NIST SP 800-144'], 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-02', 'CLOUD-GOVERN', 'Shared Responsibility Model', 'Definição clara de responsabilidades entre CSP e cliente', 'Garantir que não haja gaps de responsabilidade', 'Controles são implementados por parte responsável apropriada', 'Critical', 1.5, 'GRC', 'Gaps no modelo de responsabilidade compartilhada causam vulnerabilidades', ARRAY['CSA CCM SRM', 'ISO 27017', 'AWS/Azure/GCP Shared Responsibility'], 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-03', 'CLOUD-GOVERN', 'Cloud Vendor Management', 'Gestão de fornecedores de serviços cloud', 'Garantir due diligence e monitoramento contínuo de CSPs', 'Riscos de fornecedores são conhecidos e geridos', 'High', 1.3, 'GRC', 'Fornecedores não avaliados podem introduzir riscos significativos', ARRAY['CSA CCM STA', 'ISO 27036', 'NIST SP 800-53 SA-9'], 'CLOUD_SECURITY'),
  ('CLOUD-IAM-01', 'CLOUD-IAM', 'Identity Federation & SSO', 'Federação de identidades e single sign-on para cloud', 'Centralizar autenticação e simplificar gestão de identidades', 'Autenticação consistente e gerenciável em múltiplos ambientes', 'High', 1.3, 'Engineering', 'Identidades fragmentadas aumentam superfície de ataque', ARRAY['CSA CCM IAM', 'NIST SP 800-63', 'ISO 27001 A.9'], 'CLOUD_SECURITY'),
  ('CLOUD-IAM-02', 'CLOUD-IAM', 'Privileged Access Management', 'Gestão de acessos privilegiados em ambientes cloud', 'Controlar e monitorar acessos administrativos', 'Acessos privilegiados são mínimos, monitorados e auditados', 'Critical', 1.5, 'Engineering', 'Acessos privilegiados comprometidos causam danos severos', ARRAY['CSA CCM IAM', 'CIS Controls', 'NIST SP 800-53 AC'], 'CLOUD_SECURITY'),
  ('CLOUD-IAM-03', 'CLOUD-IAM', 'Service Account & API Key Management', 'Gestão de contas de serviço e chaves de API', 'Controlar identidades não-humanas em cloud', 'Service accounts e API keys são geridos com ciclo de vida controlado', 'High', 1.3, 'Engineering', 'Chaves expostas ou contas de serviço mal configuradas são vetores de ataque', ARRAY['CSA CCM IAM', 'CIS Benchmarks', 'NIST SP 800-53 IA'], 'CLOUD_SECURITY'),
  ('CLOUD-DATA-01', 'CLOUD-DATA', 'Data Encryption & Key Management', 'Criptografia de dados e gestão de chaves em cloud', 'Proteger dados em repouso e em trânsito', 'Dados são criptografados com chaves geridas adequadamente', 'Critical', 1.5, 'Engineering', 'Dados não criptografados podem ser expostos em caso de breach', ARRAY['CSA CCM DSP', 'CSA CCM EKM', 'NIST SP 800-57'], 'CLOUD_SECURITY'),
  ('CLOUD-DATA-02', 'CLOUD-DATA', 'Data Loss Prevention', 'Prevenção de vazamento de dados em cloud', 'Detectar e prevenir exfiltração de dados sensíveis', 'Dados sensíveis não são exfiltrados acidentalmente ou maliciosamente', 'High', 1.3, 'Engineering', 'Sem DLP, vazamentos podem ocorrer sem detecção', ARRAY['CSA CCM DSP', 'NIST SP 800-53 SC-7', 'ISO 27001 A.8'], 'CLOUD_SECURITY'),
  ('CLOUD-DATA-03', 'CLOUD-DATA', 'Data Classification & Governance', 'Classificação e governança de dados em cloud', 'Identificar e classificar dados para aplicar controles apropriados', 'Dados são tratados conforme sua sensibilidade', 'High', 1.3, 'GRC', 'Sem classificação, dados sensíveis podem não ser protegidos', ARRAY['CSA CCM DSP', 'ISO 27001 A.8', 'LGPD'], 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-01', 'CLOUD-INFRA', 'Network Security & Segmentation', 'Segurança e segmentação de redes em cloud', 'Isolar workloads e controlar tráfego de rede', 'Comunicações são controladas e segmentadas', 'Critical', 1.5, 'Engineering', 'Redes flat permitem movimentação lateral', ARRAY['CSA CCM IVS', 'CIS Benchmarks', 'NIST SP 800-53 SC'], 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-02', 'CLOUD-INFRA', 'Security Groups & Firewalls', 'Grupos de segurança e firewalls em cloud', 'Controlar acesso de rede a recursos', 'Apenas tráfego autorizado alcança recursos', 'High', 1.4, 'Engineering', 'Regras permissivas expõem recursos', ARRAY['CSA CCM IVS', 'CIS Benchmarks', 'AWS/Azure/GCP Security Best Practices'], 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-03', 'CLOUD-INFRA', 'Compute Hardening', 'Hardening de instâncias compute', 'Minimizar superfície de ataque de VMs e instâncias', 'Instâncias seguem baseline de segurança', 'High', 1.3, 'Engineering', 'Instâncias não hardened são vulneráveis', ARRAY['CIS Benchmarks', 'NIST SP 800-123', 'CSA CCM IVS'], 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-01', 'CLOUD-POSTURE', 'CSPM Implementation', 'Implementação de Cloud Security Posture Management', 'Detectar e corrigir misconfigurações continuamente', 'Configurações são monitoradas e corrigidas automaticamente', 'Critical', 1.5, 'Engineering', 'Misconfigurações são causa principal de breaches em cloud', ARRAY['CSA CCM', 'CIS Benchmarks', 'Gartner CSPM'], 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-02', 'CLOUD-POSTURE', 'Compliance Monitoring', 'Monitoramento contínuo de compliance', 'Garantir conformidade contínua com políticas e regulações', 'Desvios de compliance são detectados e corrigidos rapidamente', 'High', 1.3, 'GRC', 'Compliance point-in-time não detecta drift', ARRAY['CSA CCM GRC', 'SOC 2', 'ISO 27001'], 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-03', 'CLOUD-POSTURE', 'Configuration Drift Detection', 'Detecção de drift de configuração', 'Identificar mudanças não autorizadas em configurações', 'Drift é detectado e alertado em tempo real', 'High', 1.3, 'Engineering', 'Drift pode introduzir vulnerabilidades silenciosamente', ARRAY['CSA CCM', 'CIS Controls', 'NIST SP 800-53 CM'], 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-01', 'CLOUD-WORKLOAD', 'Container Security', 'Segurança de containers em runtime', 'Proteger containers durante execução', 'Containers são monitorados e protegidos em runtime', 'High', 1.4, 'Engineering', 'Containers comprometidos afetam workloads', ARRAY['CIS Docker Benchmark', 'NIST SP 800-190', 'CSA Container Security'], 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-02', 'CLOUD-WORKLOAD', 'Serverless Security', 'Segurança de funções serverless', 'Proteger funções Lambda, Cloud Functions, etc.', 'Funções serverless são seguras e monitoradas', 'High', 1.3, 'Engineering', 'Serverless tem superfície de ataque diferente', ARRAY['OWASP Serverless', 'CSA', 'AWS Lambda Security'], 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-03', 'CLOUD-WORKLOAD', 'Runtime Protection', 'Proteção em tempo de execução', 'Detectar e bloquear ameaças em workloads ativos', 'Comportamento anômalo é detectado e bloqueado', 'High', 1.3, 'Engineering', 'Sem proteção runtime, ataques não são detectados', ARRAY['CWPP', 'CSA', 'NIST SP 800-53 SI'], 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-01', 'CLOUD-DETECT', 'Cloud Logging & Monitoring', 'Logging e monitoramento centralizados', 'Capturar eventos de segurança de todos os recursos', 'Visibilidade completa de eventos de segurança', 'Critical', 1.5, 'Engineering', 'Sem logs, incidentes não podem ser investigados', ARRAY['CSA CCM LOG', 'CIS Controls', 'NIST SP 800-92'], 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-02', 'CLOUD-DETECT', 'Threat Detection', 'Detecção de ameaças em cloud', 'Identificar comportamentos maliciosos e anomalias', 'Ameaças são detectadas em tempo hábil', 'High', 1.4, 'Engineering', 'Ameaças não detectadas causam danos severos', ARRAY['CSA CCM', 'MITRE ATT&CK Cloud', 'AWS GuardDuty/Azure Defender'], 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-03', 'CLOUD-DETECT', 'Incident Response', 'Resposta a incidentes em cloud', 'Responder e remediar incidentes rapidamente', 'Incidentes são contidos e remediados efetivamente', 'High', 1.4, 'Engineering', 'Resposta lenta aumenta impacto de incidentes', ARRAY['CSA CCM SEF', 'NIST SP 800-61', 'ISO 27035'], 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-01', 'CLOUD-RESILIENCE', 'Backup & Recovery', 'Backup e recuperação de dados', 'Garantir recuperabilidade de dados críticos', 'Dados podem ser recuperados conforme RTO/RPO', 'Critical', 1.5, 'Engineering', 'Sem backup, perda de dados é irrecuperável', ARRAY['CSA CCM BCR', 'ISO 22301', 'NIST SP 800-34'], 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-02', 'CLOUD-RESILIENCE', 'Disaster Recovery', 'Recuperação de desastres em cloud', 'Garantir continuidade em caso de desastre', 'Serviços são recuperados dentro do RTO definido', 'High', 1.4, 'Engineering', 'DR inadequado causa interrupção prolongada', ARRAY['CSA CCM BCR', 'ISO 22301', 'AWS/Azure DR Best Practices'], 'CLOUD_SECURITY')
ON CONFLICT (subcat_id) DO UPDATE SET
  domain_id = EXCLUDED.domain_id,
  subcat_name = EXCLUDED.subcat_name,
  definition = EXCLUDED.definition,
  objective = EXCLUDED.objective,
  security_outcome = EXCLUDED.security_outcome,
  criticality = EXCLUDED.criticality,
  weight = EXCLUDED.weight,
  ownership_type = EXCLUDED.ownership_type,
  risk_summary = EXCLUDED.risk_summary,
  framework_refs = EXCLUDED.framework_refs,
  security_domain_id = EXCLUDED.security_domain_id;

-- Seed DevSecOps subcategories
INSERT INTO public.subcategories (subcat_id, domain_id, subcat_name, definition, objective, security_outcome, criticality, weight, ownership_type, risk_summary, framework_refs, security_domain_id)
VALUES
  ('DEVSEC-GOVERN-01', 'DEVSEC-GOVERN', 'DevSecOps Strategy & Culture', 'Estratégia de shift-left e cultura de segurança no desenvolvimento', 'Integrar segurança como responsabilidade de todo o time', 'Segurança é considerada desde o início do SDLC', 'High', 1.3, 'GRC', 'Sem cultura DevSecOps, segurança é tratada como blocker', ARRAY['NIST SSDF PO.1', 'OWASP SAMM', 'BSIMM'], 'DEVSECOPS'),
  ('DEVSEC-GOVERN-02', 'DEVSEC-GOVERN', 'Security Requirements & Design', 'Requisitos de segurança e design seguro', 'Definir requisitos de segurança antes do desenvolvimento', 'Aplicações são projetadas com segurança by design', 'High', 1.3, 'Engineering', 'Requisitos não definidos resultam em controles inadequados', ARRAY['NIST SSDF PW.1', 'OWASP ASVS', 'NIST SP 800-160'], 'DEVSECOPS'),
  ('DEVSEC-GOVERN-03', 'DEVSEC-GOVERN', 'Security Metrics & KPIs', 'Métricas e indicadores de segurança no desenvolvimento', 'Medir e melhorar continuamente a maturidade DevSecOps', 'Decisões baseadas em dados, melhoria contínua', 'Medium', 1.1, 'GRC', 'Sem métricas, melhoria é subjetiva e inconsistente', ARRAY['NIST SSDF PO.4', 'OWASP SAMM', 'BSIMM'], 'DEVSECOPS'),
  ('DEVSEC-CODE-01', 'DEVSEC-CODE', 'Secure Coding Standards', 'Padrões e guidelines de código seguro', 'Padronizar práticas de desenvolvimento seguro', 'Código segue padrões que previnem vulnerabilidades comuns', 'High', 1.3, 'Engineering', 'Sem padrões, cada desenvolvedor codifica diferente', ARRAY['OWASP Secure Coding', 'CERT', 'NIST SSDF PW.5'], 'DEVSECOPS'),
  ('DEVSEC-CODE-02', 'DEVSEC-CODE', 'Static Analysis (SAST)', 'Análise estática de código para identificar vulnerabilidades', 'Detectar vulnerabilidades no código antes do deploy', 'Vulnerabilidades são identificadas early no SDLC', 'High', 1.4, 'Engineering', 'Vulnerabilidades no código chegam à produção', ARRAY['NIST SSDF PW.7', 'OWASP', 'CWE Top 25'], 'DEVSECOPS'),
  ('DEVSEC-CODE-03', 'DEVSEC-CODE', 'Code Review & Pair Programming', 'Revisão de código com foco em segurança', 'Identificar issues de segurança através de revisão humana', 'Bugs de segurança são encontrados por revisão peer', 'Medium', 1.2, 'Engineering', 'Revisão sem foco em segurança não identifica vulnerabilidades', ARRAY['NIST SSDF PW.7', 'OWASP', 'BSIMM'], 'DEVSECOPS'),
  ('DEVSEC-DEPS-01', 'DEVSEC-DEPS', 'Software Composition Analysis', 'Análise de composição de software e dependências', 'Identificar vulnerabilidades em dependências third-party', 'Dependências vulneráveis são identificadas e atualizadas', 'Critical', 1.5, 'Engineering', 'Dependências vulneráveis são vetor comum de ataque', ARRAY['NIST SSDF PS.3', 'OWASP Dependency-Check', 'SLSA'], 'DEVSECOPS'),
  ('DEVSEC-DEPS-02', 'DEVSEC-DEPS', 'SBOM Generation & Management', 'Geração e gestão de Software Bill of Materials', 'Manter inventário de componentes de software', 'Visibilidade completa de componentes para resposta rápida', 'High', 1.3, 'Engineering', 'Sem SBOM, não é possível responder a vulnerabilidades em componentes', ARRAY['NIST SSDF PS.3', 'NTIA SBOM', 'SLSA'], 'DEVSECOPS'),
  ('DEVSEC-DEPS-03', 'DEVSEC-DEPS', 'Supply Chain Security', 'Segurança da cadeia de suprimentos de software', 'Proteger contra ataques na supply chain', 'Componentes externos são verificados e confiáveis', 'Critical', 1.5, 'Engineering', 'Supply chain attacks têm impacto massivo', ARRAY['SLSA', 'NIST SSDF', 'Sigstore'], 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-01', 'DEVSEC-PIPELINE', 'Pipeline Hardening', 'Hardening de pipelines CI/CD', 'Proteger o pipeline contra ataques e manipulação', 'Pipeline é seguro e não pode ser comprometido', 'Critical', 1.5, 'Engineering', 'Pipeline comprometido compromete todos os deploys', ARRAY['NIST SSDF PO.3', 'CIS Software Supply Chain', 'SLSA'], 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-02', 'DEVSEC-PIPELINE', 'Secrets Management', 'Gestão de segredos no pipeline', 'Proteger credenciais e secrets usados no pipeline', 'Secrets não são expostos e são rotacionados', 'Critical', 1.5, 'Engineering', 'Secrets expostos comprometem todo o ambiente', ARRAY['NIST SSDF PS.2', 'CIS Controls', 'Vault Best Practices'], 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-03', 'DEVSEC-PIPELINE', 'Build Integrity', 'Integridade de build', 'Garantir que artefatos são íntegros e não manipulados', 'Artefatos são assinados e verificados', 'High', 1.4, 'Engineering', 'Artefatos manipulados podem conter malware', ARRAY['SLSA', 'NIST SSDF PS.1', 'Sigstore'], 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-01', 'DEVSEC-CONTAINER', 'Image Scanning', 'Scan de imagens de containers', 'Identificar vulnerabilidades em imagens antes do deploy', 'Imagens vulneráveis não são deployadas', 'High', 1.4, 'Engineering', 'Imagens vulneráveis propagam riscos', ARRAY['CIS Docker Benchmark', 'NIST SP 800-190', 'Trivy/Clair'], 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-02', 'DEVSEC-CONTAINER', 'Base Image Hardening', 'Hardening de imagens base', 'Minimizar superfície de ataque em imagens', 'Imagens são mínimas e hardened', 'High', 1.3, 'Engineering', 'Imagens bloated têm maior superfície de ataque', ARRAY['CIS Docker Benchmark', 'Distroless', 'Alpine Best Practices'], 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-03', 'DEVSEC-CONTAINER', 'Registry Security', 'Segurança de registries de imagens', 'Proteger repositórios de imagens', 'Registries são seguros e controlados', 'High', 1.3, 'Engineering', 'Registry comprometido distribui imagens maliciosas', ARRAY['CIS Docker Benchmark', 'Harbor Security', 'ECR/ACR Best Practices'], 'DEVSECOPS'),
  ('DEVSEC-IAC-01', 'DEVSEC-IAC', 'IaC Security Scanning', 'Scan de segurança de Infrastructure as Code', 'Identificar misconfigurações em templates', 'Templates IaC são seguros antes do deploy', 'High', 1.4, 'Engineering', 'IaC inseguro cria infraestrutura vulnerável', ARRAY['Checkov', 'tfsec', 'KICS'], 'DEVSECOPS'),
  ('DEVSEC-IAC-02', 'DEVSEC-IAC', 'Policy as Code', 'Políticas como código', 'Definir e enforçar políticas programaticamente', 'Políticas são aplicadas automaticamente', 'High', 1.3, 'Engineering', 'Políticas manuais são inconsistentes', ARRAY['OPA', 'Sentinel', 'Kyverno'], 'DEVSECOPS'),
  ('DEVSEC-IAC-03', 'DEVSEC-IAC', 'Secure Templates', 'Templates seguros e aprovados', 'Fornecer templates pré-aprovados para uso', 'Equipes usam templates seguros por padrão', 'Medium', 1.2, 'Engineering', 'Sem templates, cada equipe reinventa a roda', ARRAY['AWS Landing Zone', 'Azure Blueprints', 'Terraform Modules'], 'DEVSECOPS'),
  ('DEVSEC-TEST-01', 'DEVSEC-TEST', 'Dynamic Testing (DAST)', 'Testes dinâmicos de segurança', 'Testar aplicações em runtime para vulnerabilidades', 'Vulnerabilidades runtime são identificadas', 'High', 1.4, 'Engineering', 'Algumas vulnerabilidades só aparecem em runtime', ARRAY['OWASP ZAP', 'Burp Suite', 'NIST SSDF PW.8'], 'DEVSECOPS'),
  ('DEVSEC-TEST-02', 'DEVSEC-TEST', 'API Security Testing', 'Testes de segurança de APIs', 'Testar APIs para vulnerabilidades específicas', 'APIs são seguras e resistentes a ataques', 'High', 1.4, 'Engineering', 'APIs são superfície de ataque principal', ARRAY['OWASP API Security', 'Postman Security', 'NIST SSDF'], 'DEVSECOPS'),
  ('DEVSEC-TEST-03', 'DEVSEC-TEST', 'Penetration Testing', 'Testes de penetração', 'Simular ataques reais para encontrar vulnerabilidades', 'Vulnerabilidades críticas são encontradas antes de atacantes', 'High', 1.4, 'Engineering', 'Pen tests encontram o que ferramentas não encontram', ARRAY['PTES', 'OWASP Testing Guide', 'NIST SP 800-115'], 'DEVSECOPS'),
  ('DEVSEC-VULN-01', 'DEVSEC-VULN', 'Vulnerability Prioritization', 'Priorização de vulnerabilidades', 'Focar em vulnerabilidades de maior risco', 'Recursos são alocados para riscos mais críticos', 'High', 1.3, 'Engineering', 'Tratar todas vulnerabilidades igualmente é ineficiente', ARRAY['CVSS', 'EPSS', 'SSVC'], 'DEVSECOPS'),
  ('DEVSEC-VULN-02', 'DEVSEC-VULN', 'Remediation SLAs', 'SLAs de remediação', 'Definir e cumprir prazos de correção', 'Vulnerabilidades são corrigidas dentro do SLA', 'High', 1.3, 'GRC', 'Sem SLAs, vulnerabilidades ficam abertas indefinidamente', ARRAY['PCI DSS', 'NIST CSF', 'ISO 27001'], 'DEVSECOPS'),
  ('DEVSEC-VULN-03', 'DEVSEC-VULN', 'Vulnerability Tracking', 'Tracking e métricas de vulnerabilidades', 'Rastrear vulnerabilidades do descobrimento à remediação', 'Visibilidade completa do ciclo de vida de vulnerabilidades', 'Medium', 1.2, 'Engineering', 'Sem tracking, vulnerabilidades se perdem', ARRAY['DefectDojo', 'Jira Security', 'NIST SSDF'], 'DEVSECOPS')
ON CONFLICT (subcat_id) DO UPDATE SET
  domain_id = EXCLUDED.domain_id,
  subcat_name = EXCLUDED.subcat_name,
  definition = EXCLUDED.definition,
  objective = EXCLUDED.objective,
  security_outcome = EXCLUDED.security_outcome,
  criticality = EXCLUDED.criticality,
  weight = EXCLUDED.weight,
  ownership_type = EXCLUDED.ownership_type,
  risk_summary = EXCLUDED.risk_summary,
  framework_refs = EXCLUDED.framework_refs,
  security_domain_id = EXCLUDED.security_domain_id;

-- Seed Cloud Security questions (36 questions)
INSERT INTO public.default_questions (question_id, subcat_id, domain_id, question_text, expected_evidence, imperative_checks, risk_summary, frameworks, ownership_type, security_domain_id)
VALUES
  ('CLOUD-GOVERN-01-Q01', 'CLOUD-GOVERN-01', 'CLOUD-GOVERN', 'Existe uma estratégia formal de cloud aprovada pela alta gestão?', 'Documento de estratégia de cloud com objetivos, princípios e roadmap', 'Verificar aprovação executiva e alinhamento com estratégia de negócio', 'Sem estratégia, adoção de cloud é fragmentada e desalinhada', ARRAY['CSA CCM GRC-01', 'ISO 27017 5.1', 'NIST SP 800-144'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-01-Q02', 'CLOUD-GOVERN-01', 'CLOUD-GOVERN', 'Existem políticas de uso de cloud documentadas e comunicadas?', 'Políticas de uso aceitável, classificação de dados para cloud, e requisitos de segurança', 'Verificar comunicação e aderência pelas equipes', 'Políticas inexistentes levam a uso inseguro e não padronizado', ARRAY['CSA CCM GRC-02', 'ISO 27001 5.2', 'CIS Controls 1'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-02-Q01', 'CLOUD-GOVERN-02', 'CLOUD-GOVERN', 'O modelo de responsabilidade compartilhada está documentado para cada CSP utilizado?', 'Matriz de responsabilidades por tipo de serviço (IaaS, PaaS, SaaS) e CSP', 'Verificar que todas as responsabilidades do cliente estão atribuídas e implementadas', 'Gaps no modelo causam controles não implementados', ARRAY['CSA CCM SRM-01', 'ISO 27017 CLD.6.3', 'AWS/Azure Shared Responsibility'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-02-Q02', 'CLOUD-GOVERN-02', 'CLOUD-GOVERN', 'As responsabilidades de segurança cloud estão claramente atribuídas internamente?', 'Matriz RACI com responsabilidades de segurança cloud por função', 'Verificar que não há gaps de responsabilidade e que owners estão cientes', 'Responsabilidades ambíguas causam gaps de controle', ARRAY['CSA CCM GRC-03', 'ISO 27001 5.3', 'NIST SP 800-53 PM-2'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-GOVERN-03-Q01', 'CLOUD-GOVERN-03', 'CLOUD-GOVERN', 'Existe processo de due diligence para seleção de provedores cloud?', 'Checklist de avaliação, relatórios SOC 2/ISO dos CSPs, matriz de riscos', 'Verificar que due diligence é realizada antes da contratação', 'Fornecedores não avaliados podem não atender requisitos de segurança', ARRAY['CSA CCM STA-01', 'ISO 27036', 'NIST SP 800-53 SA-9'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-IAM-01-Q01', 'CLOUD-IAM-01', 'CLOUD-IAM', 'A federação de identidades está implementada entre o IdP corporativo e os CSPs?', 'Configuração de SAML/OIDC, diagrama de arquitetura de IdP', 'Verificar que usuários não precisam de credenciais separadas por CSP', 'Identidades separadas aumentam superfície de ataque e complexidade', ARRAY['CSA CCM IAM-01', 'NIST SP 800-63B', 'ISO 27001 A.9.2'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-IAM-01-Q02', 'CLOUD-IAM-01', 'CLOUD-IAM', 'MFA é obrigatório para acesso a ambientes cloud?', 'Políticas de MFA configuradas, relatório de compliance de MFA', 'Verificar que não há exceções para contas administrativas', 'Sem MFA, credenciais comprometidas dão acesso direto', ARRAY['CSA CCM IAM-02', 'CIS Controls 6', 'NIST SP 800-63B'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-IAM-02-Q01', 'CLOUD-IAM-02', 'CLOUD-IAM', 'Existe processo de gestão de acessos privilegiados (PAM) para ambientes cloud?', 'Ferramenta PAM implementada, políticas de acesso privilegiado, logs de sessão', 'Verificar que acessos admin são via PAM com sessões gravadas', 'Acessos privilegiados não geridos são alto risco', ARRAY['CSA CCM IAM-03', 'CIS Controls 5', 'NIST SP 800-53 AC-2'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-IAM-02-Q02', 'CLOUD-IAM-02', 'CLOUD-IAM', 'É aplicado o princípio de menor privilégio em políticas de acesso cloud?', 'Revisão de políticas IAM, relatório de permissões excessivas', 'Verificar ausência de políticas como AdminAccess para usuários', 'Privilégios excessivos amplificam impacto de comprometimento', ARRAY['CSA CCM IAM-04', 'CIS Controls 5', 'NIST SP 800-53 AC-6'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-IAM-03-Q01', 'CLOUD-IAM-03', 'CLOUD-IAM', 'Service accounts são geridas com ciclo de vida definido?', 'Inventário de service accounts, processo de criação/desativação, rotação de credenciais', 'Verificar que service accounts órfãs são identificadas e removidas', 'Service accounts abandonadas são vetor de ataque', ARRAY['CSA CCM IAM-05', 'CIS Benchmarks', 'NIST SP 800-53 IA-4'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DATA-01-Q01', 'CLOUD-DATA-01', 'CLOUD-DATA', 'Dados sensíveis são criptografados em repouso em todos os serviços cloud?', 'Configuração de encryption at rest, inventário de dados com status de criptografia', 'Verificar que não há exceções para dados sensíveis', 'Dados não criptografados podem ser expostos em breach', ARRAY['CSA CCM DSP-01', 'NIST SP 800-57', 'ISO 27001 A.10'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DATA-01-Q02', 'CLOUD-DATA-01', 'CLOUD-DATA', 'As chaves de criptografia são geridas adequadamente (CMK vs CSP-managed)?', 'Política de gestão de chaves, inventário de CMKs, processo de rotação', 'Verificar rotação de chaves e separação de duties', 'Chaves mal geridas comprometem toda a criptografia', ARRAY['CSA CCM EKM-01', 'NIST SP 800-57', 'CIS Controls'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DATA-02-Q01', 'CLOUD-DATA-02', 'CLOUD-DATA', 'Existe solução de DLP implementada para ambientes cloud?', 'Ferramenta DLP configurada, políticas de detecção, relatórios de incidentes', 'Verificar cobertura de storage, email e endpoints cloud', 'Sem DLP, exfiltração de dados pode não ser detectada', ARRAY['CSA CCM DSP-02', 'NIST SP 800-53 SC-7', 'ISO 27001 A.8'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DATA-03-Q01', 'CLOUD-DATA-03', 'CLOUD-DATA', 'Dados em cloud são classificados conforme política de classificação?', 'Política de classificação, inventário de dados com classificação, labels aplicados', 'Verificar que classificação é aplicada e atualizada', 'Sem classificação, dados sensíveis podem não ser protegidos adequadamente', ARRAY['CSA CCM DSP-03', 'ISO 27001 A.8.2', 'LGPD Art. 46'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-01-Q01', 'CLOUD-INFRA-01', 'CLOUD-INFRA', 'As VPCs/VNets estão segmentadas por ambiente e criticidade?', 'Diagrama de arquitetura de rede, configuração de VPCs/subnets', 'Verificar isolamento entre prod/dev e entre workloads críticos', 'Rede flat permite movimentação lateral', ARRAY['CSA CCM IVS-01', 'CIS Benchmarks', 'NIST SP 800-53 SC-7'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-01-Q02', 'CLOUD-INFRA-01', 'CLOUD-INFRA', 'Transit gateways e peerings são controlados e documentados?', 'Inventário de conectividade, aprovação de peerings, diagrama de transit', 'Verificar que não há peerings não autorizados', 'Conectividade não controlada expõe redes', ARRAY['CSA CCM IVS-02', 'AWS Transit Gateway Best Practices', 'Azure Hub-Spoke'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-02-Q01', 'CLOUD-INFRA-02', 'CLOUD-INFRA', 'Security groups seguem princípio de menor privilégio de rede?', 'Audit de security groups, regras justificadas, revisão periódica', 'Verificar ausência de 0.0.0.0/0 em portas sensíveis', 'Regras permissivas expõem recursos à internet', ARRAY['CSA CCM IVS-03', 'CIS Benchmarks', 'NIST SP 800-53 SC-7'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-INFRA-03-Q01', 'CLOUD-INFRA-03', 'CLOUD-INFRA', 'Imagens de VMs são hardened conforme benchmark?', 'AMIs/imagens com baseline, processo de hardening, scanning de compliance', 'Verificar que imagens seguem CIS Benchmarks', 'VMs não hardened têm vulnerabilidades conhecidas', ARRAY['CIS Benchmarks', 'NIST SP 800-123', 'STIG'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-01-Q01', 'CLOUD-POSTURE-01', 'CLOUD-POSTURE', 'Existe solução de CSPM implementada e monitorando todos os ambientes?', 'Ferramenta CSPM ativa, cobertura de contas/subscriptions, dashboard de findings', 'Verificar que findings críticos são tratados com SLA', 'Misconfigurações são causa principal de breaches em cloud', ARRAY['CSA CCM', 'Gartner CSPM', 'CIS Benchmarks'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-01-Q02', 'CLOUD-POSTURE-01', 'CLOUD-POSTURE', 'Alertas de CSPM são integrados ao processo de resposta?', 'Runbooks de resposta, integração com SIEM/ticketing, métricas de MTTR', 'Verificar que alertas críticos têm SLA de resposta definido', 'Alertas não tratados deixam exposições abertas', ARRAY['CSA CCM GRC', 'NIST SP 800-61', 'ISO 27001'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-02-Q01', 'CLOUD-POSTURE-02', 'CLOUD-POSTURE', 'O compliance com políticas de cloud é monitorado continuamente?', 'Dashboard de compliance, relatórios automáticos, tendências', 'Verificar frequência de scans e cobertura de controles', 'Compliance point-in-time não detecta desvios entre auditorias', ARRAY['CSA CCM GRC', 'SOC 2', 'ISO 27001'], 'GRC', 'CLOUD_SECURITY'),
  ('CLOUD-POSTURE-03-Q01', 'CLOUD-POSTURE-03', 'CLOUD-POSTURE', 'Mudanças de configuração são detectadas e alertadas?', 'Configuração de config rules, alertas de drift, logs de mudanças', 'Verificar que mudanças não autorizadas geram alertas', 'Drift silencioso pode introduzir vulnerabilidades', ARRAY['AWS Config', 'Azure Policy', 'NIST SP 800-53 CM-3'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-01-Q01', 'CLOUD-WORKLOAD-01', 'CLOUD-WORKLOAD', 'Containers em produção são monitorados por solução de runtime security?', 'Ferramenta CWPP/runtime, políticas de detecção, alertas configurados', 'Verificar cobertura de clusters e detecção de anomalias', 'Sem runtime protection, ataques em containers não são detectados', ARRAY['CIS Kubernetes Benchmark', 'NIST SP 800-190', 'Falco/Sysdig'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-02-Q01', 'CLOUD-WORKLOAD-02', 'CLOUD-WORKLOAD', 'Funções serverless têm permissões mínimas configuradas?', 'Revisão de roles de Lambda/Functions, análise de least privilege', 'Verificar ausência de AdministratorAccess em funções', 'Funções over-privileged amplificam impacto de vulnerabilidades', ARRAY['OWASP Serverless Top 10', 'CSA', 'AWS Lambda Security'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-WORKLOAD-03-Q01', 'CLOUD-WORKLOAD-03', 'CLOUD-WORKLOAD', 'Workloads críticos têm proteção adicional de runtime (EDR/CWPP)?', 'Ferramenta EDR/CWPP deployed, cobertura de workloads críticos', 'Verificar que workloads de alto risco têm proteção ativa', 'Workloads desprotegidos são alvo fácil', ARRAY['CWPP', 'CrowdStrike/Defender', 'NIST SP 800-53 SI'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-01-Q01', 'CLOUD-DETECT-01', 'CLOUD-DETECT', 'Logs de todos os serviços cloud são centralizados e retidos adequadamente?', 'Configuração de CloudTrail/Activity Log, retenção definida, SIEM integrado', 'Verificar que não há gaps de logging e retenção atende compliance', 'Sem logs centralizados, investigação de incidentes é impossível', ARRAY['CSA CCM LOG-01', 'CIS Controls 8', 'NIST SP 800-92'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-01-Q02', 'CLOUD-DETECT-01', 'CLOUD-DETECT', 'Logs de segurança são protegidos contra tampering?', 'Logs em bucket imutável, cross-account logging, integridade verificada', 'Verificar que atacantes não podem apagar evidências', 'Logs manipulados comprometem investigações', ARRAY['CSA CCM LOG-02', 'CIS Controls 8', 'NIST SP 800-53 AU-9'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-02-Q01', 'CLOUD-DETECT-02', 'CLOUD-DETECT', 'Serviços nativos de detecção de ameaças estão habilitados (GuardDuty, Defender)?', 'GuardDuty/Defender/Security Command Center ativo, alertas configurados', 'Verificar cobertura de todas as contas e regiões', 'Ameaças conhecidas não são detectadas sem estes serviços', ARRAY['AWS GuardDuty', 'Azure Defender', 'GCP Security Command Center'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-02-Q02', 'CLOUD-DETECT-02', 'CLOUD-DETECT', 'Alertas de segurança cloud são correlacionados no SIEM corporativo?', 'Integração com SIEM, use cases de correlação, dashboards unificados', 'Verificar que alertas cloud são visíveis para SOC', 'Alertas isolados perdem contexto de ataque', ARRAY['CSA CCM SEF', 'MITRE ATT&CK Cloud', 'Splunk/Sentinel'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-03-Q01', 'CLOUD-DETECT-03', 'CLOUD-DETECT', 'Existe playbook de resposta a incidentes específico para cloud?', 'Playbooks documentados, runbooks automatizados, treinamento realizado', 'Verificar que playbooks foram testados via exercício', 'Resposta improvisada é lenta e pode piorar situação', ARRAY['CSA CCM SEF-01', 'NIST SP 800-61', 'AWS/Azure IR Guides'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-DETECT-03-Q02', 'CLOUD-DETECT-03', 'CLOUD-DETECT', 'A equipe de resposta tem acesso e ferramentas para investigar incidentes cloud?', 'Ferramentas forenses cloud, acessos de emergência (break-glass), treinamento', 'Verificar que IR team pode coletar evidências rapidamente', 'Sem ferramentas, investigação é atrasada', ARRAY['CSA CCM SEF-02', 'NIST SP 800-86', 'SANS Cloud Forensics'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-01-Q01', 'CLOUD-RESILIENCE-01', 'CLOUD-RESILIENCE', 'Backups de dados críticos em cloud são realizados e testados?', 'Política de backup, configuração de snapshots/replicação, testes de restore', 'Verificar que restore foi testado recentemente', 'Backups não testados podem falhar quando necessários', ARRAY['CSA CCM BCR-01', 'ISO 22301', 'NIST SP 800-34'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-01-Q02', 'CLOUD-RESILIENCE-01', 'CLOUD-RESILIENCE', 'Backups são protegidos contra ransomware (imutabilidade, air-gap)?', 'Configuração de immutable backups, cross-account/region, vaulting', 'Verificar que backups não podem ser deletados por atacantes', 'Ransomware pode criptografar backups acessíveis', ARRAY['CSA CCM BCR-02', 'NIST CSF', 'AWS Backup Vault Lock'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-02-Q01', 'CLOUD-RESILIENCE-02', 'CLOUD-RESILIENCE', 'Existe plano de DR documentado para workloads críticos em cloud?', 'Plano de DR, RTO/RPO definidos, arquitetura multi-region', 'Verificar que DR foi testado no último ano', 'DR não testado pode falhar em situação real', ARRAY['CSA CCM BCR-03', 'ISO 22301', 'AWS/Azure DR Guides'], 'Engineering', 'CLOUD_SECURITY'),
  ('CLOUD-RESILIENCE-02-Q02', 'CLOUD-RESILIENCE-02', 'CLOUD-RESILIENCE', 'Failover automático está configurado para serviços críticos?', 'Configuração de failover, testes realizados, métricas de RTO', 'Verificar que failover automático funciona conforme esperado', 'Failover manual é lento e propenso a erros', ARRAY['CSA CCM BCR-04', 'AWS Multi-AZ', 'Azure Availability Zones'], 'Engineering', 'CLOUD_SECURITY')
ON CONFLICT (question_id) DO UPDATE SET
  subcat_id = EXCLUDED.subcat_id,
  domain_id = EXCLUDED.domain_id,
  question_text = EXCLUDED.question_text,
  expected_evidence = EXCLUDED.expected_evidence,
  imperative_checks = EXCLUDED.imperative_checks,
  risk_summary = EXCLUDED.risk_summary,
  frameworks = EXCLUDED.frameworks,
  ownership_type = EXCLUDED.ownership_type,
  security_domain_id = EXCLUDED.security_domain_id;

-- Seed DevSecOps questions (44 questions)
INSERT INTO public.default_questions (question_id, subcat_id, domain_id, question_text, expected_evidence, imperative_checks, risk_summary, frameworks, ownership_type, security_domain_id)
VALUES
  ('DEVSEC-GOVERN-01-Q01', 'DEVSEC-GOVERN-01', 'DEVSEC-GOVERN', 'Existe uma estratégia formal de DevSecOps aprovada pela liderança?', 'Documento de estratégia DevSecOps com objetivos, roadmap e métricas', 'Verificar aprovação executiva e comunicação para times', 'Sem estratégia, iniciativas de segurança são fragmentadas', ARRAY['NIST SSDF PO.1.1', 'OWASP SAMM Governance', 'BSIMM'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-GOVERN-01-Q02', 'DEVSEC-GOVERN-01', 'DEVSEC-GOVERN', 'Os desenvolvedores recebem treinamento regular em segurança?', 'Programa de treinamento, registros de participação, conteúdo atualizado', 'Verificar frequência, cobertura e eficácia do treinamento', 'Desenvolvedores não treinados introduzem vulnerabilidades', ARRAY['NIST SSDF PO.2.2', 'OWASP SAMM Education', 'PCI DSS 6.5'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-GOVERN-02-Q01', 'DEVSEC-GOVERN-02', 'DEVSEC-GOVERN', 'Requisitos de segurança são definidos no início de cada projeto?', 'Templates de requisitos de segurança, exemplos de projetos com requisitos', 'Verificar que requisitos são rastreados e validados', 'Requisitos tardios resultam em retrabalho ou gaps', ARRAY['NIST SSDF PW.1.1', 'OWASP ASVS', 'NIST SP 800-160'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-GOVERN-02-Q02', 'DEVSEC-GOVERN-02', 'DEVSEC-GOVERN', 'É realizada modelagem de ameaças (threat modeling) para aplicações críticas?', 'Relatórios de threat modeling, metodologia utilizada (STRIDE, PASTA)', 'Verificar cobertura de aplicações críticas e atualização periódica', 'Sem threat modeling, ameaças específicas não são identificadas', ARRAY['NIST SSDF PW.1.2', 'OWASP Threat Modeling', 'STRIDE'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-GOVERN-03-Q01', 'DEVSEC-GOVERN-03', 'DEVSEC-GOVERN', 'Métricas de segurança são coletadas e reportadas regularmente?', 'Dashboard de métricas, relatórios periódicos, KPIs definidos', 'Verificar que métricas influenciam decisões e melhorias', 'Sem métricas, melhoria é subjetiva', ARRAY['NIST SSDF PO.4.1', 'OWASP SAMM', 'BSIMM'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-GOVERN-03-Q02', 'DEVSEC-GOVERN-03', 'DEVSEC-GOVERN', 'Existem metas de segurança definidas para times de desenvolvimento?', 'OKRs ou metas de segurança, integração com performance reviews', 'Verificar que metas são realistas e acompanhadas', 'Sem metas, segurança compete com features', ARRAY['NIST SSDF PO.4.2', 'OWASP SAMM', 'BSIMM'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-CODE-01-Q01', 'DEVSEC-CODE-01', 'DEVSEC-CODE', 'Existem padrões de código seguro documentados e acessíveis?', 'Guia de código seguro, exemplos, integração com IDE', 'Verificar que padrões são atualizados e utilizados', 'Sem padrões, cada desenvolvedor codifica diferente', ARRAY['OWASP Secure Coding Practices', 'CERT Secure Coding', 'NIST SSDF PW.5'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CODE-01-Q02', 'DEVSEC-CODE-01', 'DEVSEC-CODE', 'Linters e formatters de segurança estão integrados no ambiente de desenvolvimento?', 'Configuração de linters (ESLint security, Semgrep), pre-commit hooks', 'Verificar que issues de segurança são bloqueados no commit', 'Issues básicos passam despercebidos sem linting', ARRAY['OWASP', 'Semgrep Rules', 'ESLint Security'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CODE-02-Q01', 'DEVSEC-CODE-02', 'DEVSEC-CODE', 'SAST é executado automaticamente no pipeline de CI?', 'Configuração de SAST no CI, relatórios de findings, gates definidos', 'Verificar que builds falham para findings críticos', 'Vulnerabilidades no código chegam à produção', ARRAY['NIST SSDF PW.7.1', 'OWASP', 'CWE Top 25'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CODE-02-Q02', 'DEVSEC-CODE-02', 'DEVSEC-CODE', 'Findings de SAST são triados e corrigidos com SLA definido?', 'Processo de triagem, tracking de findings, métricas de MTTR', 'Verificar que não há backlog crescente de findings críticos', 'Findings ignorados acumulam débito de segurança', ARRAY['NIST SSDF PW.7.2', 'OWASP', 'BSIMM'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CODE-03-Q01', 'DEVSEC-CODE-03', 'DEVSEC-CODE', 'Code reviews incluem checklist de segurança?', 'Template de review com itens de segurança, evidência de uso', 'Verificar que reviewers são treinados em segurança', 'Reviews focados apenas em funcionalidade perdem bugs de segurança', ARRAY['NIST SSDF PW.7', 'OWASP Code Review Guide', 'BSIMM'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-01-Q01', 'DEVSEC-DEPS-01', 'DEVSEC-DEPS', 'SCA é executado automaticamente no pipeline?', 'Ferramenta SCA integrada (Snyk, Dependabot), relatórios de vulnerabilidades', 'Verificar que vulnerabilidades críticas bloqueiam deploy', 'Dependências vulneráveis são vetor comum de ataque', ARRAY['NIST SSDF PS.3.1', 'OWASP Dependency-Check', 'Snyk'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-01-Q02', 'DEVSEC-DEPS-01', 'DEVSEC-DEPS', 'Dependências vulneráveis são atualizadas dentro de SLA definido?', 'SLA de atualização por severidade, métricas de compliance', 'Verificar que vulnerabilidades críticas têm SLA de 24-48h', 'Dependências desatualizadas mantêm exposição', ARRAY['NIST SSDF PS.3.2', 'PCI DSS 6.2', 'OWASP'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-02-Q01', 'DEVSEC-DEPS-02', 'DEVSEC-DEPS', 'SBOM é gerado automaticamente para cada release?', 'SBOMs em formato padrão (SPDX, CycloneDX), armazenamento centralizado', 'Verificar que SBOM é completo e atualizado', 'Sem SBOM, resposta a vulnerabilidades é lenta', ARRAY['NTIA SBOM', 'NIST SSDF PS.3', 'Executive Order 14028'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-02-Q02', 'DEVSEC-DEPS-02', 'DEVSEC-DEPS', 'SBOMs são utilizados para identificar impacto de novas vulnerabilidades?', 'Processo de busca em SBOMs, ferramentas de query, tempo de resposta', 'Verificar que novos CVEs podem ser mapeados rapidamente', 'Sem busca em SBOM, impacto de CVEs não é conhecido', ARRAY['NTIA SBOM', 'NIST SSDF', 'Log4Shell lessons'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-03-Q01', 'DEVSEC-DEPS-03', 'DEVSEC-DEPS', 'Existe verificação de integridade de pacotes baixados?', 'Verificação de checksums, lock files, mirrors confiáveis', 'Verificar que pacotes não podem ser substituídos por maliciosos', 'Typosquatting e dependency confusion são ataques comuns', ARRAY['SLSA', 'NIST SSDF PS.1', 'npm/pip security'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-DEPS-03-Q02', 'DEVSEC-DEPS-03', 'DEVSEC-DEPS', 'Dependências são obtidas de registries internos/proxy controlados?', 'Configuração de Artifactory/Nexus, políticas de proxy', 'Verificar que não há download direto de registries públicos', 'Registries públicos podem servir pacotes maliciosos', ARRAY['SLSA', 'NIST SSDF', 'JFrog Xray'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-01-Q01', 'DEVSEC-PIPELINE-01', 'DEVSEC-PIPELINE', 'O pipeline de CI/CD segue princípio de menor privilégio?', 'Revisão de permissões de pipeline, service accounts dedicadas', 'Verificar que pipeline não tem acesso admin desnecessário', 'Pipeline com privilégios excessivos amplifica impacto de comprometimento', ARRAY['NIST SSDF PO.3.1', 'CIS Software Supply Chain', 'SLSA'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-01-Q02', 'DEVSEC-PIPELINE-01', 'DEVSEC-PIPELINE', 'Mudanças no pipeline requerem aprovação e são auditadas?', 'Configuração de branch protection, logs de mudanças, processo de aprovação', 'Verificar que mudanças no pipeline passam por review', 'Mudanças não revisadas podem inserir backdoors', ARRAY['NIST SSDF PO.3.2', 'GitHub Branch Protection', 'GitLab Protected Branches'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-02-Q01', 'DEVSEC-PIPELINE-02', 'DEVSEC-PIPELINE', 'Secrets são geridos via vault/secrets manager e não hardcoded?', 'Integração com Vault/AWS Secrets Manager, scan de secrets no código', 'Verificar ausência de secrets em código, configs e logs', 'Secrets expostos comprometem todo o ambiente', ARRAY['NIST SSDF PS.2.1', 'CIS Controls', 'HashiCorp Vault'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-02-Q02', 'DEVSEC-PIPELINE-02', 'DEVSEC-PIPELINE', 'Existe detecção automática de secrets vazados no código?', 'Ferramentas como GitLeaks, TruffleHog integradas no CI', 'Verificar que commits com secrets são bloqueados', 'Secrets commitados ficam no histórico para sempre', ARRAY['GitLeaks', 'TruffleHog', 'GitHub Secret Scanning'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-02-Q03', 'DEVSEC-PIPELINE-02', 'DEVSEC-PIPELINE', 'Secrets são rotacionados periodicamente?', 'Política de rotação, automação de rotação, métricas de idade', 'Verificar que secrets antigos são identificados e rotacionados', 'Secrets antigos têm maior chance de estar comprometidos', ARRAY['NIST SSDF PS.2.2', 'CIS Controls', 'AWS Secrets Manager Rotation'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-03-Q01', 'DEVSEC-PIPELINE-03', 'DEVSEC-PIPELINE', 'Artefatos de build são assinados digitalmente?', 'Processo de assinatura, verificação de assinaturas no deploy', 'Verificar que artefatos não assinados não são deployados', 'Artefatos não assinados podem ser substituídos', ARRAY['SLSA', 'Sigstore', 'NIST SSDF PS.1'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-PIPELINE-03-Q02', 'DEVSEC-PIPELINE-03', 'DEVSEC-PIPELINE', 'Provenance de builds é registrada e verificável?', 'Attestations de build, logs de provenance, SLSA level atingido', 'Verificar que builds são reproduzíveis e auditáveis', 'Sem provenance, origem de artefatos não é verificável', ARRAY['SLSA', 'in-toto', 'NIST SSDF'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-01-Q01', 'DEVSEC-CONTAINER-01', 'DEVSEC-CONTAINER', 'Imagens são escaneadas para vulnerabilidades antes do deploy?', 'Ferramenta de scan (Trivy, Clair) integrada, gates de vulnerabilidade', 'Verificar que imagens com vulns críticas não são deployadas', 'Imagens vulneráveis propagam riscos para runtime', ARRAY['CIS Docker Benchmark', 'NIST SP 800-190', 'Trivy'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-01-Q02', 'DEVSEC-CONTAINER-01', 'DEVSEC-CONTAINER', 'Imagens em produção são re-escaneadas periodicamente?', 'Política de re-scan, alertas de novas vulnerabilidades', 'Verificar que vulnerabilidades novas em imagens existentes são detectadas', 'Novas CVEs afetam imagens já deployadas', ARRAY['CIS Docker Benchmark', 'Continuous Scanning', 'Harbor'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-02-Q01', 'DEVSEC-CONTAINER-02', 'DEVSEC-CONTAINER', 'Imagens base são mínimas (distroless, alpine, scratch)?', 'Inventário de imagens base, análise de tamanho e pacotes', 'Verificar que imagens não incluem shells ou pacotes desnecessários', 'Imagens grandes têm maior superfície de ataque', ARRAY['Distroless', 'Alpine', 'CIS Docker Benchmark'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-02-Q02', 'DEVSEC-CONTAINER-02', 'DEVSEC-CONTAINER', 'Containers rodam como non-root por padrão?', 'Verificação de USER em Dockerfiles, políticas de admission', 'Verificar que containers não rodam como root em produção', 'Root em container facilita escape e escalação', ARRAY['CIS Docker Benchmark', 'Pod Security Standards', 'NIST SP 800-190'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-03-Q01', 'DEVSEC-CONTAINER-03', 'DEVSEC-CONTAINER', 'O registry de imagens tem controle de acesso adequado?', 'Configuração de RBAC no registry, logs de acesso', 'Verificar que apenas pipelines autorizados podem push', 'Registry aberto permite push de imagens maliciosas', ARRAY['CIS Docker Benchmark', 'Harbor', 'ECR/ACR Best Practices'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-CONTAINER-03-Q02', 'DEVSEC-CONTAINER-03', 'DEVSEC-CONTAINER', 'Apenas imagens de registries confiáveis são permitidas em produção?', 'Políticas de admission, allowlist de registries', 'Verificar que imagens de Docker Hub público são bloqueadas', 'Imagens de fontes não confiáveis podem ser maliciosas', ARRAY['Pod Security Admission', 'OPA Gatekeeper', 'Kyverno'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-IAC-01-Q01', 'DEVSEC-IAC-01', 'DEVSEC-IAC', 'Templates de IaC são escaneados para misconfigurações?', 'Ferramenta de scan IaC (Checkov, tfsec), integração no CI', 'Verificar que misconfigurações críticas bloqueiam merge', 'IaC inseguro cria infraestrutura vulnerável em escala', ARRAY['Checkov', 'tfsec', 'KICS'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-IAC-01-Q02', 'DEVSEC-IAC-01', 'DEVSEC-IAC', 'Findings de IaC são corrigidos antes do deploy?', 'Processo de remediação, métricas de findings abertos', 'Verificar que não há acúmulo de findings ignorados', 'Findings ignorados são deployados em produção', ARRAY['Checkov', 'tfsec', 'Bridgecrew'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-IAC-02-Q01', 'DEVSEC-IAC-02', 'DEVSEC-IAC', 'Políticas de segurança são definidas como código (OPA, Sentinel)?', 'Políticas em repositório, testes de políticas, enforcement automático', 'Verificar que políticas são versionadas e testadas', 'Políticas manuais são inconsistentes e difíceis de auditar', ARRAY['OPA', 'Sentinel', 'Kyverno'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-IAC-02-Q02', 'DEVSEC-IAC-02', 'DEVSEC-IAC', 'Políticas bloqueiam recursos não conformes automaticamente?', 'Configuração de admission controllers, logs de bloqueios', 'Verificar que enforcement é ativo e não apenas alertas', 'Políticas que apenas alertam são ignoradas', ARRAY['OPA Gatekeeper', 'Azure Policy', 'AWS Service Control Policies'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-IAC-03-Q01', 'DEVSEC-IAC-03', 'DEVSEC-IAC', 'Existem módulos/templates aprovados para uso comum?', 'Catálogo de módulos, processo de aprovação, versionamento', 'Verificar que módulos são mantidos e atualizados', 'Sem módulos padrão, cada time reinventa soluções', ARRAY['Terraform Registry', 'AWS Landing Zone', 'Azure Blueprints'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-01-Q01', 'DEVSEC-TEST-01', 'DEVSEC-TEST', 'DAST é executado em ambientes de staging/pré-prod?', 'Ferramenta DAST (ZAP, Burp), relatórios de scans, integração CI/CD', 'Verificar que DAST é executado antes de cada release', 'Vulnerabilidades runtime não são encontradas por SAST', ARRAY['OWASP ZAP', 'Burp Suite', 'NIST SSDF PW.8'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-01-Q02', 'DEVSEC-TEST-01', 'DEVSEC-TEST', 'Findings de DAST são triados e corrigidos com prioridade?', 'Processo de triagem, tracking de findings, métricas', 'Verificar que findings críticos bloqueiam release', 'Findings de DAST ignorados vão para produção', ARRAY['OWASP', 'NIST SSDF', 'BSIMM'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-02-Q01', 'DEVSEC-TEST-02', 'DEVSEC-TEST', 'APIs são testadas especificamente para vulnerabilidades do OWASP API Top 10?', 'Testes de API security, cobertura de OWASP API Top 10', 'Verificar que BOLA, broken auth, injection são testados', 'APIs são superfície de ataque principal moderna', ARRAY['OWASP API Security', 'Postman', 'Burp Suite'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-02-Q02', 'DEVSEC-TEST-02', 'DEVSEC-TEST', 'Contratos de API (OpenAPI) incluem requisitos de segurança?', 'Specs OpenAPI com securitySchemes, validação de specs', 'Verificar que autenticação/autorização estão definidas', 'APIs sem contratos são difíceis de testar e proteger', ARRAY['OpenAPI Security', 'OWASP API Security', 'Spectral'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-03-Q01', 'DEVSEC-TEST-03', 'DEVSEC-TEST', 'Pen tests são realizados periodicamente para aplicações críticas?', 'Relatórios de pen test, escopo, remediação de findings', 'Verificar frequência (ao menos anual) e cobertura', 'Pen tests encontram vulnerabilidades que ferramentas não encontram', ARRAY['PTES', 'OWASP Testing Guide', 'NIST SP 800-115'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-TEST-03-Q02', 'DEVSEC-TEST-03', 'DEVSEC-TEST', 'Findings de pen test críticos são remediados antes do report final?', 'Evidência de remediação durante engagement, retest', 'Verificar que findings críticos não ficam abertos', 'Findings de pen test abertos são riscos conhecidos', ARRAY['PTES', 'OWASP', 'PCI DSS 11.3'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-VULN-01-Q01', 'DEVSEC-VULN-01', 'DEVSEC-VULN', 'Vulnerabilidades são priorizadas usando metodologia risk-based?', 'Uso de CVSS+EPSS, contexto de exposição, criticidade de ativo', 'Verificar que não é apenas CVSS score', 'Priorização apenas por CVSS gera muito ruído', ARRAY['EPSS', 'SSVC', 'CVSS'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-VULN-01-Q02', 'DEVSEC-VULN-01', 'DEVSEC-VULN', 'Existe processo para vulnerabilidades exploited in the wild?', 'Monitoramento de CISA KEV, processo acelerado para KEV', 'Verificar que KEV tem SLA mais agressivo', 'Vulnerabilidades ativamente exploradas requerem urgência', ARRAY['CISA KEV', 'EPSS', 'Mandiant'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-VULN-02-Q01', 'DEVSEC-VULN-02', 'DEVSEC-VULN', 'Existem SLAs de remediação definidos por severidade?', 'Política de SLAs (Crítico: 24h, Alto: 7d, etc.), métricas de compliance', 'Verificar que SLAs são realistas e cumpridos', 'Sem SLAs, vulnerabilidades ficam abertas indefinidamente', ARRAY['PCI DSS', 'NIST CSF', 'ISO 27001'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-VULN-02-Q02', 'DEVSEC-VULN-02', 'DEVSEC-VULN', 'Exceções de SLA são documentadas e aprovadas?', 'Processo de exceção, aprovações, compensating controls', 'Verificar que exceções não são rotineiras', 'Exceções sem controle viram padrão', ARRAY['Risk Acceptance', 'ISO 27001', 'GRC'], 'GRC', 'DEVSECOPS'),
  ('DEVSEC-VULN-03-Q01', 'DEVSEC-VULN-03', 'DEVSEC-VULN', 'Existe ferramenta centralizada para tracking de vulnerabilidades?', 'Ferramenta (DefectDojo, Jira), dashboards, integração com scanners', 'Verificar que todas as fontes alimentam a ferramenta', 'Sem centralização, vulnerabilidades se perdem', ARRAY['DefectDojo', 'ThreadFix', 'Jira Security'], 'Engineering', 'DEVSECOPS'),
  ('DEVSEC-VULN-03-Q02', 'DEVSEC-VULN-03', 'DEVSEC-VULN', 'Métricas de vulnerabilidades são reportadas para liderança?', 'Relatórios executivos, tendências, SLA compliance', 'Verificar que métricas influenciam priorização de recursos', 'Sem visibilidade executiva, segurança perde prioridade', ARRAY['BSIMM', 'OWASP SAMM', 'ISO 27001'], 'GRC', 'DEVSECOPS')
ON CONFLICT (question_id) DO UPDATE SET
  subcat_id = EXCLUDED.subcat_id,
  domain_id = EXCLUDED.domain_id,
  question_text = EXCLUDED.question_text,
  expected_evidence = EXCLUDED.expected_evidence,
  imperative_checks = EXCLUDED.imperative_checks,
  risk_summary = EXCLUDED.risk_summary,
  frameworks = EXCLUDED.frameworks,
  ownership_type = EXCLUDED.ownership_type,
  security_domain_id = EXCLUDED.security_domain_id;